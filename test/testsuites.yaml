# Select test suites to be run. This list is used together with Git diff.
# run_if_changed defines path expressions (regexp) and associated test suites to be run
# if those paths are changed.
# "NoTests" defines path expressions that don't require any tests to be run on change.

# All test suites would be run if there's a change in paths that is not listed above.
# E.g. for changes in hack, olm-catalog, openshift, vendor, test etc.

# Each path in the Git diff is checked against all "run_if_changed"
# regular expressions. For each element in the list, if the path matches any of the expressions
# in the "run_if_changed" list then all testsuites from that element are added to the list of test
# suites to be run. If the path doesn't match any expression in any element then it's an unknown
# change with a potentially high impact and should be treated
testsuites:
  - name: "Always"
    # Runs always because run_if_changed is omitted.
    tests:
      - name: serverless_operator_e2e_tests
  - name: "Eventing Kafka"
    run_if_changed:
      - "^knative-operator/pkg/controller/knativekafka/"
      - "^knative-operator/pkg/webhook/knativekafka/"
    tests:
      - name: serverless_operator_kafka_e2e_tests
      - name: downstream_knative_kafka_e2e_tests
      - name: upstream_knative_eventing_kafka_e2e #TODO: Run this at all? Should this be removed?
      - name: upstream_knative_eventing_kafka_broker_e2e
  - name: "Eventing"
    run_if_changed:
      - "^knative-operator/pkg/controller/knativeeventing/"
      - "^knative-operator/pkg/webhook/knativeeventing/"
      - "^openshift-knative-operator/cmd/operator/kodata/knative-eventing/"
      - "^openshift-knative-operator/pkg/eventing/"
    tests:
      - name: downstream_eventing_e2e_tests
      - name: upstream_knative_eventing_e2e
  - name: "Monitoring"
    run_if_changed:
      - "^knative-operator/pkg/monitoring/"
      - "^openshift-knative-operator/cmd/operator/kodata/monitoring/"
      - "^openshift-knative-operator/pkg/monitoring/"
    tests:
      - name: downstream_monitoring_e2e_tests
  - name: "Serving"
    run_if_changed:
      - "^knative-operator/pkg/controller/knativeserving/"
      - "^knative-operator/pkg/webhook/knativeserving/"
      - "^openshift-knative-operator/cmd/operator/kodata/knative-serving/"
      - "^openshift-knative-operator/pkg/serving/"
      - "^serving/ingress/"
    tests:
      - name: downstream_serving_e2e_tests
  - name: "UI"
    run_if_changed:
      - "^ui/"
    tests:
      - name: ui_tests
  - name: "NoTests"
    # No test suites will be run for the changes below.
    run_if_changed:
      - "^.github/"
      - "^docs/"
      - "^hack/generate/"
      - "^hack/patches/"
      - "\\.(md|adoc)$"
      - "^(README|LICENSE)$"
      - "^(OWNERS|OWNERS_ALIASES)$"

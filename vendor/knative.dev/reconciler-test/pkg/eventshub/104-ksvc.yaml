apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: {{ .name }}
  namespace: {{ .namespace }}
  {{ if .annotations }}
  annotations:
    {{ range $key, $value := .annotations }}
      {{ $key }}: "{{ $value }}"
      {{ end }}
  {{ end }}
spec:
  # TODO: Add security context???
  template:
    {{ if .podannotations }}
    annotations:
      {{ range $key, $value := .podannotations }}
        {{ $key }}: "{{ $value }}"
        {{ end }}
    {{ end }}
    spec:
      containers:
        - name: eventshub
          # TODO: Return to {{ .image }}
          image: registry.ci.openshift.org/openshift/knative-nightly:knative-eventing-test-eventshub
          imagePullPolicy: "IfNotPresent"
          env:
            - name: "SYSTEM_NAMESPACE"
              valueFrom:
                fieldRef:
                  fieldPath: "metadata.namespace"
            - name: "POD_NAME"
              valueFrom:
                fieldRef:
                  fieldPath: "metadata.name"
            - name: "EVENT_LOGS"
              value: "recorder,logger"
            {{ range $key, $value := .envs }}
            - name: {{printf "%q" $key}}
              value: {{printf "%q" $value}}
            {{ end }}
